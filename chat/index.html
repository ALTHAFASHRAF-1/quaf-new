<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon32x32.png">
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Primary Meta Tags -->
    <title>WhatsApp Web</title>
    <meta name="title" content="WhatsApp Web">
    <meta name="description" content="Real-time chat application with Google Sheets backend">

    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
    * {
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
    }
    
    :root {
        --whatsapp-green: #00a884;
        --whatsapp-light-green: #25d366;
        --whatsapp-dark-green: #008069;
        --whatsapp-chat-bg: #f0f2f5;
        --whatsapp-message-out: #d9fdd3;
        --whatsapp-message-in: #ffffff;
        --whatsapp-text-dark: #111b21;
        --whatsapp-text-light: #667781;
        --whatsapp-border: #e9edef;
        --whatsapp-hover: #f5f6f6;
        --whatsapp-sidebar: #fff;
        --whatsapp-input-bg: #fff;
        --whatsapp-header: #f0f2f5;
    }
    
    body {
        font-family: 'Roboto', sans-serif;
        line-height: 1.6;
        background: linear-gradient(to bottom right, #00a884, #128c7e);
        min-height: 100vh;
        -webkit-text-size-adjust: 100%;
        -moz-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
        text-size-adjust: 100%;
    }

    .hidden {
        display: none !important;
    }

    /* WhatsApp Theme */
    .whatsapp-bg {
        background: var(--whatsapp-chat-bg);
    }

    .whatsapp-green {
        background-color: var(--whatsapp-green);
    }

    .whatsapp-light-green {
        background-color: var(--whatsapp-light-green);
    }

    .message-out {
        background-color: var(--whatsapp-message-out);
        color: var(--whatsapp-text-dark);
        border-radius: 7.5px 0 7.5px 7.5px;
        max-width: 65%;
        margin-left: auto;
        box-shadow: 0 1px 0.5px rgba(11, 20, 26, 0.13);
        position: relative;
    }

    .message-out::before {
        content: '';
        position: absolute;
        right: -8px;
        top: 0;
        border-left: 8px solid var(--whatsapp-message-out);
        border-bottom: 8px solid transparent;
    }

    .message-in {
        background-color: var(--whatsapp-message-in);
        color: var(--whatsapp-text-dark);
        border-radius: 0 7.5px 7.5px 7.5px;
        max-width: 65%;
        box-shadow: 0 1px 0.5px rgba(11, 20, 26, 0.13);
        position: relative;
    }

    .message-in::before {
        content: '';
        position: absolute;
        left: -8px;
        top: 0;
        border-right: 8px solid var(--whatsapp-message-in);
        border-bottom: 8px solid transparent;
    }

    .typing-indicator {
        display: inline-flex;
        padding: 8px 12px;
        background-color: var(--whatsapp-message-in);
        border-radius: 18px;
        align-items: center;
        box-shadow: 0 1px 0.5px rgba(11, 20, 26, 0.13);
    }

    .typing-dot {
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background-color: var(--whatsapp-text-light);
        margin: 0 1px;
        animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes typing {
        0%, 60%, 100% {
            transform: translateY(0);
            opacity: 0.4;
        }
        30% {
            transform: translateY(-4px);
            opacity: 1;
        }
    }

    /* Chat container */
    .chat-container {
        height: calc(100vh - 120px);
        overflow-y: auto;
        scroll-behavior: smooth;
        background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'><defs><pattern id='a' width='40' height='40' patternUnits='userSpaceOnUse'><path d='M20 0v40M0 20h40' fill='none' stroke='%23000000' stroke-opacity='0.03' stroke-width='0.5'/></pattern></defs><rect width='100%' height='100%' fill='url(%23a)'/></svg>");
        background-attachment: fixed;
    }

    /* Profile picture */
    .profile-pic {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 1px solid var(--whatsapp-border);
    }

    .profile-pic-small {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        object-fit: cover;
        border: 1px solid var(--whatsapp-border);
    }

    .profile-pic-fallback {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--whatsapp-light-green), var(--whatsapp-dark-green));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 16px;
        font-weight: 500;
        border: 1px solid var(--whatsapp-border);
    }

    /* Chat list item */
    .chat-item {
        transition: background-color 0.2s ease;
        cursor: pointer;
        border-bottom: 1px solid var(--whatsapp-border);
        background: var(--whatsapp-sidebar);
    }

    .chat-item:hover {
        background-color: var(--whatsapp-hover);
    }

    .chat-item.active {
        background-color: var(--whatsapp-hover);
        border-left: 3px solid var(--whatsapp-green);
    }

    /* Message input */
    .message-input {
        background-color: var(--whatsapp-input-bg);
        border: 1px solid var(--whatsapp-border);
        color: var(--whatsapp-text-dark);
        border-radius: 8px;
        padding: 9px 12px;
        font-size: 15px;
        resize: none;
        max-height: 120px;
        box-shadow: 0 1px 1px rgba(11, 20, 26, 0.05);
    }

    .message-input:focus {
        outline: none;
        border-color: var(--whatsapp-green);
        box-shadow: 0 0 0 1px var(--whatsapp-green);
    }

    /* Attachment button */
    .attach-btn {
        color: var(--whatsapp-text-light);
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: background-color 0.2s ease;
    }

    .attach-btn:hover {
        background-color: rgba(134, 150, 160, 0.1);
    }

    /* Emoji picker */
    .emoji-picker-container {
        position: absolute;
        bottom: 70px;
        right: 20px;
        z-index: 1000;
        display: none;
        border: 1px solid var(--whatsapp-border);
        box-shadow: 0 2px 5px rgba(11, 20, 26, 0.15);
    }

    .emoji-picker-container.show {
        display: block;
    }

    /* File upload preview */
    .file-preview {
        background-color: var(--whatsapp-input-bg);
        border: 1px solid var(--whatsapp-border);
        border-radius: 8px;
        padding: 12px;
        margin: 8px 0;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 1px 1px rgba(11, 20, 26, 0.05);
    }

    .file-icon {
        width: 40px;
        height: 40px;
        background: var(--whatsapp-green);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    /* Online indicator */
    .online-indicator {
        width: 8px;
        height: 8px;
        background-color: var(--whatsapp-light-green);
        border-radius: 50%;
        position: absolute;
        bottom: 2px;
        right: 2px;
        border: 2px solid var(--whatsapp-sidebar);
    }

    /* Message time */
    .message-time {
        font-size: 11px;
        color: var(--whatsapp-text-light);
        margin-top: 3px;
        text-align: right;
    }

    /* Scrollbar styling */
    .chat-container::-webkit-scrollbar {
        width: 6px;
    }

    .chat-container::-webkit-scrollbar-track {
        background: transparent;
    }

    .chat-container::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.15);
        border-radius: 3px;
    }

    .chat-container::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.25);
    }

    /* Loading animation */
    .loading-dots {
        display: inline-flex;
        gap: 4px;
    }

    .loading-dots span {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: var(--whatsapp-green);
        animation: loading 1.4s infinite;
    }

    .loading-dots span:nth-child(2) {
        animation-delay: 0.2s;
    }

    .loading-dots span:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes loading {
        0%, 100% {
            opacity: 0.2;
            transform: scale(0.8);
        }
        50% {
            opacity: 1;
            transform: scale(1);
        }
    }

    /* WhatsApp Header */
    .whatsapp-header {
        background: var(--whatsapp-header);
        border-bottom: 1px solid var(--whatsapp-border);
    }

    .whatsapp-sidebar {
        background: var(--whatsapp-sidebar);
        border-right: 1px solid var(--whatsapp-border);
    }

    .whatsapp-chat-header {
        background: var(--whatsapp-header);
        border-bottom: 1px solid var(--whatsapp-border);
    }

    /* Search input */
    .search-input {
        background: var(--whatsapp-input-bg);
        border: 1px solid var(--whatsapp-border);
        color: var(--whatsapp-text-dark);
    }

    .search-input:focus {
        outline: none;
        border-color: var(--whatsapp-green);
    }

    /* Login page */
    .login-container {
        background: var(--whatsapp-sidebar);
        border-radius: 8px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
    }

    .login-header {
        background: var(--whatsapp-green);
        color: white;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
        .chat-container {
            height: calc(100vh - 140px);
        }
        
        .profile-pic {
            width: 36px;
            height: 36px;
        }
        
        .profile-pic-small {
            width: 28px;
            height: 28px;
        }
        
        .message-out, .message-in {
            max-width: 85%;
        }
    }

    @media (max-width: 480px) {
        .chat-container {
            height: calc(100vh - 160px);
        }
        
        .profile-pic {
            width: 32px;
            height: 32px;
        }
        
        .profile-pic-small {
            width: 24px;
            height: 24px;
        }
        
        .message-out, .message-in {
            max-width: 90%;
        }
    }

    /* Safe area insets for mobile */
    @supports (padding: max(0px)) {
        body {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
    }

    /* Modal styles */
    .modal-overlay {
        background: rgba(11, 20, 26, 0.7);
    }

    .modal-content {
        background: var(--whatsapp-sidebar);
        border: 1px solid var(--whatsapp-border);
        box-shadow: 0 8px 24px rgba(11, 20, 26, 0.2);
    }

    /* Button styles */
    .btn-primary {
        background: var(--whatsapp-green);
        color: white;
        border: none;
        border-radius: 4px;
        padding: 10px 20px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
    }

    .btn-primary:hover {
        background: var(--whatsapp-dark-green);
    }

    .btn-secondary {
        background: var(--whatsapp-input-bg);
        color: var(--whatsapp-text-dark);
        border: 1px solid var(--whatsapp-border);
        border-radius: 4px;
        padding: 10px 20px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
    }

    .btn-secondary:hover {
        background: var(--whatsapp-hover);
    }
    </style>
</head>
<body class="text-gray-800">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="login-container w-full max-w-md">
            <div class="login-header rounded-t-lg p-6 text-center">
                <div class="w-16 h-16 bg-white rounded-full mx-auto mb-4 flex items-center justify-center">
                    <i class="fab fa-whatsapp text-3xl text-green-600"></i>
                </div>
                <h1 class="text-2xl font-bold">WhatsApp Web</h1>
                <p class="text-white/90 mt-1">Connect with your friends</p>
            </div>

            <div class="p-6">
                <!-- Login Section -->
                <div id="loginSection">
                    <form id="loginForm">
                        <div class="space-y-4">
                            <div>
                                <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Admission Number</label>
                                <input type="text" id="username" name="username" required
                                    class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                    placeholder="Enter admission number">
                            </div>
                            
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="password" id="password" name="password" required
                                    class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                    placeholder="Enter password">
                            </div>

                            <div id="loginError" class="bg-red-50 border border-red-200 rounded-lg p-3 text-red-600 text-sm hidden"></div>

                            <button type="submit" class="btn-primary w-full flex items-center justify-center">
                                <i class="fas fa-sign-in-alt mr-2"></i>Sign In
                            </button>
                        </div>
                    </form>

                    <div class="text-center mt-4">
                        <p class="text-gray-600 text-sm">Contact admin if you forgot your password</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Dashboard Container -->
    <div id="dashboardContainer" class="hidden min-h-screen">
        <!-- Header -->
        <header class="whatsapp-header">
            <div class="container mx-auto px-4 py-3">
                <div class="flex justify-between items-center">
                    <!-- Logo and Title -->
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center">
                            <i class="fab fa-whatsapp text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold text-gray-800">WhatsApp Web</h1>
                            <p id="welcomeUser" class="text-xs text-gray-600">Welcome</p>
                        </div>
                    </div>
                    
                    <!-- Profile Section -->
                    <div class="relative">
                        <button onclick="toggleProfileMenu()" class="focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 rounded-full">
                            <div class="relative">
                                <img id="profilePic" src="" alt="Profile" class="profile-pic" 
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIyMCIgZmlsbD0iI0VCRUJFQiIvPjxwYXRoIGQ9Ik0yMCAxMUMyMi4yMDYgMTEgMjQgMTIuNzk0IDI0IDE1QzI0IDE3LjIwNiAyMi4yMDYgMTkgMjAgMTlDMTcuNzk0IDE5IDE2IDE3LjIwNiAxNiAxNUMxNiAxMi43OTQgMTcuNzk0IDExIDIwIDExWk0yMCAyMUMyMy44NiAyMSAyNyAyNC4xNCAyNyAyOEgyM0gyN0MyNyAzMS44NiAyMy44NiAzNSAyMCAzNUMxNi4xNCAzNSAxMyAzMS44NiAxMyAyOEgxN0gxM0MxMyAyNC4xNCAxNi4xNCAyMSAyMCAyMVoiIGZpbGw9IiM5Nzk3OTciLz48L3N2Zz4='">
                            </div>
                        </button>
                        
                        <!-- Profile Dropdown Menu -->
                        <div id="profileMenu" class="absolute top-full right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 z-50 hidden">
                            <div class="p-4 border-b border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <div class="relative">
                                        <img id="menuProfilePic" src="" alt="Profile" class="profile-pic-small"
                                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIyMCIgZmlsbD0iI0VCRUJFQiIvPjxwYXRoIGQ9Ik0yMCAxMUMyMi4yMDYgMTEgMjQgMTIuNzk0IDI0IDE1QzI0IDE3LjIwNiAyMi4yMDYgMTkgMjAgMTlDMTcuNzk0IDE5IDE2IDE3LjIwNiAxNiAxNUMxNiAxMi43OTQgMTcuNzk0IDExIDIwIDExWk0yMCAyMUMyMy44NiAyMSAyNyAyNC4xNIDEyNyAyOEgyM0gyN0MyNyAzMS44NiAyMy44NiAzNSAyMCAzNUMxNi4xNCAzNSAxMyAzMS44NiAxMyAyOEgxN0gxM0MxMyAyNC4xNCAxNi4xNCAyMSAyMCAyMVoiIGZpbGw9IiM5Nzk3OTciLz48L3N2Zz4='">
                                    </div>
                                    <div>
                                        <div id="profileName" class="font-medium text-gray-800">User Name</div>
                                        <div id="profileAdNo" class="text-sm text-gray-600">@admission_no</div>
                                    </div>
                                </div>
                            </div>
                            <div class="py-2">
                                <button onclick="openChangePasswordModal()" class="w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center text-gray-700">
                                    <i class="fas fa-key text-gray-500 mr-3"></i>
                                    Change Password
                                </button>
                                <button onclick="logout()" class="w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center text-red-600">
                                    <i class="fas fa-sign-out-alt mr-3"></i>
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Chat Interface -->
        <main class="container mx-auto max-w-7xl h-[calc(100vh-73px)]">
            <div class="flex h-full">
                <!-- Sidebar - Chat List -->
                <div id="sidebar" class="w-full md:w-1/3 lg:w-1/4 whatsapp-sidebar flex flex-col">
                    <!-- Search Bar -->
                    <div class="p-4 border-b border-gray-200">
                        <div class="relative">
                            <input type="text" id="searchChats" 
                                   class="w-full px-4 py-2 pl-10 bg-white border border-gray-300 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                   placeholder="Search or start new chat">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>

                    <!-- Chat List -->
                    <div id="chatList" class="flex-1 overflow-y-auto">
                        <!-- Chats will be loaded here -->
                        <div class="text-center py-8">
                            <div class="loading-dots inline-block">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <p class="text-gray-600 mt-2">Loading chats...</p>
                        </div>
                    </div>

                    <!-- New Chat Button -->
                    <div class="p-4 border-t border-gray-200">
                        <button onclick="showNewChatModal()" 
                                class="btn-primary w-full flex items-center justify-center">
                            <i class="fas fa-plus mr-2"></i>New Chat
                        </button>
                    </div>
                </div>

                <!-- Main Chat Area -->
                <div id="chatArea" class="hidden md:flex flex-col flex-1">
                    <!-- Chat Header -->
                    <div id="chatHeader" class="whatsapp-chat-header p-4">
                        <!-- Selected chat header will be loaded here -->
                        <div class="text-center py-4">
                            <p class="text-gray-600">Select a chat to start messaging</p>
                        </div>
                    </div>

                    <!-- Messages Container -->
                    <div id="messagesContainer" class="chat-container p-4 flex-1">
                        <!-- Messages will be loaded here -->
                        <div class="text-center py-8">
                            <i class="fab fa-whatsapp text-4xl text-gray-300 mb-3"></i>
                            <p class="text-gray-600">Select a chat to view messages</p>
                        </div>
                    </div>

                    <!-- Message Input Area -->
                    <div id="messageInputArea" class="hidden whatsapp-chat-header p-4 border-t border-gray-200">
                        <!-- File Preview -->
                        <div id="filePreview" class="hidden"></div>

                        <!-- Input Form -->
                        <div class="flex items-end space-x-2">
                            <!-- Emoji Button -->
                            <button onclick="toggleEmojiPicker()" 
                                    class="attach-btn">
                                <i class="far fa-smile text-xl"></i>
                            </button>

                            <!-- Attachment Button -->
                            <button onclick="document.getElementById('fileInput').click()" 
                                    class="attach-btn">
                                <i class="fas fa-paperclip text-xl"></i>
                            </button>

                            <!-- Hidden File Input -->
                            <input type="file" id="fileInput" class="hidden" multiple
                                   onchange="handleFileSelect(event)">

                            <!-- Message Input -->
                            <div class="flex-1 relative">
                                <textarea id="messageInput" 
                                          class="message-input w-full"
                                          placeholder="Type a message"
                                          rows="1"
                                          oninput="autoResizeTextarea(this)"></textarea>
                            </div>

                            <!-- Send Button -->
                            <button onclick="sendMessage()" 
                                    id="sendButton"
                                    class="bg-green-500 hover:bg-green-600 text-white rounded-full w-10 h-10 flex items-center justify-center transition duration-200">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>

                        <!-- Emoji Picker -->
                        <div id="emojiPickerContainer" class="emoji-picker-container bg-white rounded-lg p-3">
                            <div class="grid grid-cols-8 gap-1 max-h-40 overflow-y-auto">
                                <!-- Common emojis will be added by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Chat Area (Full Screen) -->
                <div id="mobileChatArea" class="md:hidden flex-col flex-1 bg-white hidden">
                    <!-- Back Button and Chat Header -->
                    <div class="whatsapp-chat-header p-4 flex items-center">
                        <button onclick="closeMobileChat()" class="mr-3 text-gray-600">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div id="mobileChatHeader" class="flex-1">
                            <!-- Mobile chat header will be loaded here -->
                        </div>
                    </div>

                    <!-- Mobile Messages Container -->
                    <div id="mobileMessagesContainer" class="chat-container p-4 flex-1">
                        <!-- Messages will be loaded here -->
                    </div>

                    <!-- Mobile Message Input Area -->
                    <div id="mobileMessageInputArea" class="hidden whatsapp-chat-header p-4 border-t border-gray-200">
                        <!-- Mobile File Preview -->
                        <div id="mobileFilePreview" class="hidden"></div>

                        <!-- Mobile Input Form -->
                        <div class="flex items-end space-x-2">
                            <!-- Mobile Emoji Button -->
                            <button onclick="toggleMobileEmojiPicker()" 
                                    class="attach-btn">
                                <i class="far fa-smile text-xl"></i>
                            </button>

                            <!-- Mobile Attachment Button -->
                            <button onclick="document.getElementById('mobileFileInput').click()" 
                                    class="attach-btn">
                                <i class="fas fa-paperclip text-xl"></i>
                            </button>

                            <!-- Hidden Mobile File Input -->
                            <input type="file" id="mobileFileInput" class="hidden" multiple
                                   onchange="handleMobileFileSelect(event)">

                            <!-- Mobile Message Input -->
                            <div class="flex-1 relative">
                                <textarea id="mobileMessageInput" 
                                          class="message-input w-full"
                                          placeholder="Type a message"
                                          rows="1"
                                          oninput="autoResizeTextarea(this)"></textarea>
                            </div>

                            <!-- Mobile Send Button -->
                            <button onclick="sendMobileMessage()" 
                                    id="mobileSendButton"
                                    class="bg-green-500 hover:bg-green-600 text-white rounded-full w-10 h-10 flex items-center justify-center transition duration-200">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>

                        <!-- Mobile Emoji Picker -->
                        <div id="mobileEmojiPickerContainer" class="emoji-picker-container bg-white rounded-lg p-3">
                            <div class="grid grid-cols-8 gap-1 max-h-40 overflow-y-auto">
                                <!-- Common emojis will be added by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content rounded-lg w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">Change Password</h3>
                    <button onclick="closeChangePasswordModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="changePasswordForm">
                    <div class="space-y-4">
                        <div>
                            <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
                            <input type="password" id="currentPassword" 
                                   class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                   required>
                        </div>
                        
                        <div>
                            <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                            <input type="password" id="newPassword" 
                                   class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                   required minlength="4">
                        </div>
                        
                        <div>
                            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Confirm New Password</label>
                            <input type="password" id="confirmPassword" 
                                   class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                   required minlength="4">
                        </div>
                    </div>
                    
                    <div id="changePasswordError" class="bg-red-50 border border-red-200 rounded-lg p-3 text-red-600 text-sm mt-4 hidden"></div>
                    <div id="changePasswordSuccess" class="bg-green-50 border border-green-200 rounded-lg p-3 text-green-600 text-sm mt-4 hidden"></div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeChangePasswordModal()" 
                                class="btn-secondary">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="btn-primary flex items-center">
                            <i class="fas fa-key mr-2"></i>Change Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- New Chat Modal -->
    <div id="newChatModal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content rounded-lg w-full max-w-md max-h-[80vh] flex flex-col">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-bold text-gray-800">New Chat</h3>
                    <button onclick="closeNewChatModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4">
                <!-- Users List -->
                <div id="usersList" class="space-y-2">
                    <!-- Users will be loaded here -->
                    <div class="text-center py-4">
                        <div class="loading-dots inline-block">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <p class="text-gray-600 mt-2">Loading users...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>
</html>
