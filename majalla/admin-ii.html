<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Academic Publication Submission Form - Quaf Academic Journal">
    <meta name="keywords" content="academic journal, research papers, submission form, Islamic studies">
    <meta name="author" content="Quaf Academic Journal">
    <title>Academic Publication Admin Panel - Quaf Academic</title>
    <link rel="icon" type="image/png" href="https://quaf2026.netlify.app/majalla/logo.png">

    <!-- CSS Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
  :root {
    --primary-color: #1e3a8a;
    --secondary-color: #3b82f6;
    --accent-color: #60a5fa;
    --text-color: #1f2937;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --success-color: #10b981;
    --error-color: #ef4444;
    --warning-color: #f59e0b;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', sans-serif;
    line-height: 1.5;
    color: var(--text-color);
    background-color: var(--gray-50);
    margin: 0;
    padding: 0;
    max-width: none;
    font-size: 13px;
  }

  .academic-title {
    font-family: 'Crimson Text', serif;
  }

  /* Navigation Styles - Compact */
  .navbar {
    background: white;
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.08);
    position: sticky;
    top: 0;
    z-index: 1000;
    padding: 0;
  }

  .navbar-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 3.5rem;
    width: 100%;
  }

  .logo-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-shrink: 0;
  }

  .logo-image {
    height: 32px;
    width: auto;
    border-radius: 3px;
  }

  .logo-text-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .logo-text {
    line-height: 1;
    margin: 0;
    font-size: 1rem;
    font-weight: 700;
    color: var(--primary-color);
    letter-spacing: -0.3px;
  }

  .logo-subtitle {
    font-size: 0.65rem;
    color: var(--gray-600);
    margin: 0;
    line-height: 1;
    font-weight: 400;
    letter-spacing: 0.3px;
  }

  /* Compact Navigation Menu */
  .nav-menu {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .nav-link {
  color: var(--gray-700);
  text-decoration: none;
  font-weight: 500;
  font-size: 0.75rem;
  padding: 0.5rem 0.85rem; /* Slightly increased horizontal padding */
  border-radius: 6px;
  transition: all 0.3s ease;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  white-space: nowrap;
  background: var(--gray-50);
  border: 1px solid var(--gray-200);
  min-height: 32px;
  justify-content: center;
}

  .nav-link:hover {
    color: var(--primary-color);
    background-color: rgba(59, 130, 246, 0.1);
    border-color: var(--secondary-color);
    transform: translateY(-1px);
  }

  .nav-link.active {
    color: white;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    box-shadow: 0 2px 6px rgba(59, 130, 246, 0.25);
    border-color: var(--primary-color);
  }

  .mobile-menu-btn {
    display: none;
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    font-size: 1rem;
    color: var(--gray-700);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all 0.3s ease;
    width: 32px;
    height: 32px;
    align-items: center;
    justify-content: center;
  }

  .mobile-menu-btn:hover {
    background: var(--gray-100);
    color: var(--primary-color);
  }

  .mobile-nav {
  display: none;
  background: white;
  border-top: 1px solid var(--gray-200);
  padding: 0.75rem;
  box-shadow: 0 3px 5px -1px rgba(0, 0, 0, 0.08);
}

  .mobile-nav.active {
    display: block;
  }

  .mobile-nav .nav-link {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  color: var(--gray-700);
  text-decoration: none;
  padding: 0.7rem 0.85rem; /* Slightly increased horizontal padding */
  border-bottom: none;
  font-weight: 500;
  cursor: pointer;
  border-radius: 6px;
  margin-bottom: 0.5rem; /* Slightly increased from 0.4rem */
  transition: all 0.2s;
  background: var(--gray-50);
  border: 1px solid var(--gray-200);
  min-height: 38px;
  justify-content: flex-start;
}

  .mobile-nav .nav-link:hover {
    background: var(--gray-100);
    color: var(--primary-color);
  }

  .mobile-nav .nav-link.active {
    color: white;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-color: var(--primary-color);
  }

  /* Tab Content */
  .tab-content {
    display: none;
    animation: fadeIn 0.4s ease;
  }

  .tab-content.active {
    display: block;
  }

  /* Compact Form Container */
  .form-wrapper {
    max-width: 950px;
    margin: 1.5rem auto;
    padding: 0 0.75rem;
  }

  .form-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 1.75rem 1.5rem;
    border-radius: 12px 12px 0 0;
    text-align: center;
    box-shadow: 0 3px 10px rgba(30, 58, 138, 0.18);
  }

  .form-header h1 {
    font-size: 1.65rem;
    margin-bottom: 0.5rem;
    font-family: 'Crimson Text', serif;
    font-weight: 600;
  }

  .form-header p {
    font-size: 0.95rem;
    opacity: 0.9;
    max-width: 550px;
    margin: 0 auto;
    line-height: 1.4;
  }

  .form-container {
    background: white;
    border-radius: 0 0 12px 12px;
    box-shadow: 0 6px 20px -4px rgba(0, 0, 0, 0.08);
    padding: 1.75rem;
    border: 1px solid var(--gray-200);
    border-top: none;
  }

  .sample-note {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
    border: 1px solid #bfdbfe;
    border-radius: 10px;
    padding: 1rem 1.25rem;
    margin-bottom: 1.5rem;
    color: var(--primary-color);
    display: flex;
    align-items: flex-start;
    gap: 0.6rem;
    box-shadow: 0 1px 3px rgba(59, 130, 246, 0.08);
    font-size: 0.85rem;
  }

  .sample-note i {
    font-size: 0.95rem;
    margin-top: 0.05rem;
  }

  .form-section {
    margin-bottom: 1.75rem;
    padding: 1.5rem;
    background: var(--gray-50);
    border-radius: 10px;
    border-left: 4px solid var(--secondary-color);
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.03);
    transition: transform 0.2s;
  }

  .form-section:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
  }

  .section-title {
    font-size: 1.1rem;
    color: var(--gray-800);
    margin-bottom: 1.2rem;
    font-weight: 600;
    font-family: 'Crimson Text', serif;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    padding-bottom: 0.6rem;
    border-bottom: 1px solid var(--gray-200);
  }

  .section-title i {
    color: var(--secondary-color);
    font-size: 1rem;
  }

  .form-row {
    display: grid;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .form-row.two-cols {
    grid-template-columns: 1fr 1fr;
  }

  .form-row.three-cols {
    grid-template-columns: 1fr 1fr 1fr;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group label {
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 0.4rem;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.2rem;
  }

  .required {
    color: var(--error-color);
    font-weight: 700;
  }

  .optional {
    color: var(--gray-500);
    font-weight: 400;
    font-size: 0.7rem;
  }

  .form-group input,
  .form-group textarea,
  .form-group select {
    padding: 0.65rem 0.85rem;
    border: 2px solid var(--gray-300);
    border-radius: 6px;
    font-size: 0.82rem;
    transition: all 0.3s ease;
    background: white;
    font-family: 'Inter', sans-serif;
  }

  .form-group input:focus,
  .form-group textarea:focus,
  .form-group select:focus {
    outline: none;
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    transform: translateY(-1px);
  }

  .form-group input.error,
  .form-group textarea.error,
  .form-group select.error {
    border-color: var(--error-color);
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 100px;
    line-height: 1.4;
  }

  /* Compact File Upload Styles */
  .file-upload-container {
    position: relative;
    border: 2px dashed var(--gray-300);
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    background: white;
    transition: all 0.3s ease;
  }

  .file-upload-container:hover {
    border-color: var(--secondary-color);
    background: var(--gray-50);
  }

  .file-upload-container.dragover {
    border-color: var(--secondary-color);
    background: rgba(59, 130, 246, 0.05);
    transform: scale(1.01);
  }

  .file-input {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
  }

  .file-upload-content {
    pointer-events: none;
  }

  .file-upload-icon {
    font-size: 2.25rem;
    color: var(--gray-400);
    margin-bottom: 0.75rem;
  }

  .file-upload-text {
    color: var(--gray-600);
    font-size: 0.85rem;
    margin-bottom: 0.4rem;
  }

  .file-upload-hint {
    color: var(--gray-400);
    font-size: 0.75rem;
  }

  .file-preview {
    display: none;
    margin-top: 0.85rem;
    padding: 0.85rem;
    background: var(--gray-50);
    border-radius: 6px;
    border: 1px solid var(--gray-200);
  }

  .file-preview.active {
    display: block;
  }

  .file-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.85rem;
  }

  .file-details {
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .file-icon {
    font-size: 1.25rem;
    color: var(--secondary-color);
  }

  .file-name {
    font-weight: 600;
    color: var(--gray-800);
    font-size: 0.8rem;
  }

  .file-size {
    color: var(--gray-600);
    font-size: 0.7rem;
  }

  .file-actions {
    display: flex;
    gap: 0.4rem;
  }

  .file-remove-btn {
    background: var(--error-color);
    color: white;
    border: none;
    padding: 0.4rem 0.6rem;
    border-radius: 5px;
    font-size: 0.7rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.2rem;
  }

  .file-remove-btn:hover {
    background: #dc2626;
    transform: translateY(-1px);
  }

  .upload-progress {
    display: none;
    margin-top: 0.85rem;
  }

  .upload-progress.active {
    display: block;
  }

  .progress-bar {
    width: 100%;
    height: 6px;
    background: var(--gray-200);
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
    border-radius: 3px;
    transition: width 0.3s ease;
    width: 0%;
  }

  .progress-text {
    margin-top: 0.4rem;
    font-size: 0.75rem;
    color: var(--gray-600);
    text-align: center;
  }

  /* Compact Submit Section */
  .submit-section {
    margin-top: 1.75rem;
    padding-top: 1.5rem;
    border-top: 2px solid var(--gray-200);
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .submit-btn {
    background: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%);
    color: white;
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 40px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
    box-shadow: 0 3px 10px rgba(59, 130, 246, 0.25);
    min-height: 42px;
    white-space: nowrap;
  }

  .submit-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.35);
  }

  .submit-btn:active:not(:disabled) {
    transform: translateY(-1px);
  }

  .submit-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .loading-state {
    display: none;
    margin-top: 0.85rem;
    color: var(--gray-600);
    text-align: center;
    padding: 0.85rem;
    background: var(--gray-100);
    border-radius: 6px;
    font-size: 0.8rem;
  }

  .message {
    display: none;
    padding: 1rem 1.25rem;
    border-radius: 8px;
    margin-top: 1.2rem;
    animation: slideIn 0.4s ease;
    font-size: 0.82rem;
  }

  .success-message {
    background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    color: #065f46;
    border: 1px solid #10b981;
    box-shadow: 0 1px 6px rgba(16, 185, 129, 0.15);
  }

  .error-message {
    background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
    color: #991b1b;
    border: 1px solid #ef4444;
    box-shadow: 0 1px 6px rgba(239, 68, 68, 0.15);
  }

  .validation-error {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    color: #92400e;
    border: 1px solid #f59e0b;
    box-shadow: 0 1px 6px rgba(245, 158, 11, 0.15);
  }

  /* Compact Data Management Styles */
  .data-wrapper {
    max-width: 1350px;
    margin: 1.5rem auto;
    padding: 0 0.75rem;
  }

  .data-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 6px 20px -4px rgba(0, 0, 0, 0.08);
    padding: 1.75rem;
    border: 1px solid var(--gray-200);
  }

  .data-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1.2rem;
    margin-bottom: 1.75rem;
  }

  .stat-card {
    background: white;
    padding: 1.35rem;
    border-radius: 10px;
    border-left: 4px solid var(--secondary-color);
    text-align: center;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.04);
    transition: transform 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
  }

  .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.4rem;
  }

  .stat-label {
    color: var(--gray-600);
    font-size: 0.78rem;
    font-weight: 500;
  }

  .data-table-container {
    overflow-x: auto;
    border-radius: 10px;
    border: 1px solid var(--gray-200);
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.03);
    max-height: 75vh;
    overflow-y: auto;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1100px;
  }

  .data-table th,
  .data-table td {
    padding: 0.75rem 0.6rem;
    text-align: left;
    border-bottom: 1px solid var(--gray-200);
    font-size: 0.75rem;
    vertical-align: top;
  }

  .data-table th {
    background: var(--gray-50);
    font-weight: 600;
    color: var(--gray-800);
    position: sticky;
    top: 0;
    z-index: 10;
    white-space: nowrap;
    padding: 1rem 0.6rem;
    border-bottom: 2px solid var(--gray-300);
  }

  .data-table tbody tr {
    transition: background-color 0.2s;
  }

  .data-table tbody tr:hover {
    background-color: var(--gray-50);
  }

  .data-table .actions {
    display: flex;
    gap: 0.3rem;
    justify-content: center;
    min-width: 120px;
  }

  .action-icon {
    padding: 0.4rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.7rem;
    transition: all 0.3s ease;
    min-width: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  }

  .action-icon.edit {
    background: var(--warning-color);
    color: white;
  }

  .action-icon.delete {
    background: var(--error-color);
    color: white;
  }

  .action-icon.view {
    background: var(--secondary-color);
    color: white;
  }

  .action-icon:hover {
    transform: scale(1.08);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.12);
  }

  .truncate-text {
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .truncate-short {
    max-width: 90px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .loading-spinner {
    display: none;
    text-align: center;
    padding: 2.5rem;
    color: var(--gray-600);
    font-size: 0.85rem;
  }

  .loading-spinner.active {
    display: block;
  }

  .no-data {
    text-align: center;
    padding: 2.5rem;
    color: var(--gray-600);
    background: var(--gray-50);
    border-radius: 10px;
    margin: 0.85rem 0;
    font-size: 0.85rem;
  }

  /* Compact Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    animation: fadeIn 0.3s;
    backdrop-filter: blur(4px);
  }

  .modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem;
  }

  .modal-content {
    background: white;
    padding: 1.75rem;
    border-radius: 12px;
    max-width: 88vw;
    max-height: 88vh;
    overflow-y: auto;
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
    animation: slideIn 0.3s;
    width: 750px;
    border: 1px solid var(--gray-200);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.2rem;
    padding-bottom: 1.2rem;
    border-bottom: 2px solid var(--gray-200);
  }

  .modal-title {
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--gray-800);
    font-family: 'Crimson Text', serif;
  }

  .close-modal {
    background: var(--gray-100);
    border: none;
    font-size: 1.25rem;
    color: var(--gray-600);
    cursor: pointer;
    padding: 0.4rem;
    border-radius: 6px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
  }

  .close-modal:hover {
    background: var(--gray-200);
    color: var(--gray-800);
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideIn {
    from { transform: translateY(-40px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  /* Compact Footer Styles */
  .footer {
    background: var(--gray-900);
    color: white;
    padding: 2.5rem 0 1.5rem;
    margin-top: 3rem;
  }

  .footer-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 0.75rem;
  }

  .footer-grid {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 2.5rem;
    margin-bottom: 1.75rem;
  }

  .footer-section h3 {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 1.2rem;
    color: white;
    font-family: 'Crimson Text', serif;
  }

  .footer-section p,
  .footer-section a {
    color: #d1d5db;
    text-decoration: none;
    line-height: 1.5;
    transition: color 0.2s;
    font-size: 0.8rem;
  }

  .footer-section a:hover {
    color: white;
  }

  .footer-links {
    list-style: none;
  }

  .footer-links li {
    margin-bottom: 0.6rem;
  }

  .social-links {
    display: flex;
    gap: 0.85rem;
    margin-top: 1.2rem;
  }

  .social-links a {
    display: inline-flex;
    width: 38px;
    height: 38px;
    background: var(--gray-800);
    border-radius: 50%;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    color: white;
    font-size: 0.9rem;
  }

  .social-links a:hover {
    background: var(--secondary-color);
    transform: translateY(-2px);
    box-shadow: 0 3px 10px rgba(59, 130, 246, 0.25);
  }

  .footer-bottom {
    border-top: 1px solid var(--gray-700);
    padding-top: 1.5rem;
    text-align: center;
    color: #d1d5db;
    font-size: 0.78rem;
  }

  /* Responsive Design */
  @media (min-width: 768px) {
    .mobile-menu-btn {
      display: none;
    }
  }

  @media (max-width: 1024px) {
    .footer-grid {
      grid-template-columns: 1fr 1fr;
      gap: 1.75rem;
    }
  }

  @media (max-width: 767px) {
    .nav-menu {
      display: none;
    }

    .mobile-menu-btn {
      display: flex;
    }

    .navbar-container {
      justify-content: space-between;
    }

    .form-header h1 {
      font-size: 1.4rem;
    }
    
    .form-header p {
      font-size: 0.85rem;
    }

    .form-row.two-cols,
    .form-row.three-cols {
      grid-template-columns: 1fr;
    }

    .footer-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .logo-image {
      height: 28px;
    }

    .logo-text {
      font-size: 0.9rem;
    }

    .logo-subtitle {
      font-size: 0.6rem;
    }

    .submit-section {
      padding: 1.2rem 0;
    }

    .submit-btn {
      width: 100%;
      max-width: 260px;
    }

    .data-table {
      min-width: 950px;
    }

    .truncate-text {
      max-width: 130px;
    }

    .truncate-short {
      max-width: 70px;
    }
    
    .modal-content {
      padding: 1.2rem;
      width: 92%;
    }

    .file-upload-container {
      padding: 1.2rem;
    }

    .file-upload-icon {
      font-size: 1.75rem;
    }

    .file-info {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.6rem;
    }
  }

  @media (max-width: 480px) {
    .form-wrapper,
    .data-wrapper {
      margin: 0.85rem auto;
      padding: 0 0.4rem;
    }

    .form-container,
    .data-container {
      padding: 1.2rem;
    }

    .form-section {
      padding: 1.2rem;
    }
    
    .form-header {
      padding: 1.5rem 1.2rem;
    }

    .modal-content {
      padding: 1rem;
      width: 92%;
    }
    
    .data-stats {
      grid-template-columns: 1fr;
    }

    .nav-link {
      font-size: 0.7rem;
      padding: 0.4rem 0.6rem;
    }

    .mobile-nav .nav-link {
      font-size: 0.78rem;
    }

    .logo-text {
      font-size: 0.85rem;
    }

    .logo-subtitle {
      font-size: 0.58rem;
    }

    .file-upload-container {
      padding: 0.85rem;
    }

    .file-upload-text {
      font-size: 0.78rem;
    }

    .file-upload-hint {
      font-size: 0.7rem;
    }

    body {
      font-size: 12px;
    }
  }
</style>
  </head>

  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="navbar-container">
        <div class="logo-container">
          <img src="https://quaf2026.netlify.app/majalla/logo.png" alt="Quaf Academic Logo" class="logo-image">
          <div class="logo-text-container">
            <h1 class="logo-text academic-title">Quaf Academic</h1>
            <p class="logo-subtitle">Journal Admin Panel</p>
          </div>
        </div>
        
        <!-- Right-aligned navigation menu -->
        <div class="nav-menu">
          <a href="#" data-tab="form" class="nav-link active">
            <i class="fas fa-plus-circle"></i> Add Publication
          </a>
          <a href="#" data-tab="data" class="nav-link">
            <i class="fas fa-database"></i> Manage Data
          </a>
        </div>

        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
          <i class="fas fa-bars"></i>
        </button>
      </div>

      <div class="mobile-nav" id="mobile-nav">
        <a href="#" data-tab="form" class="nav-link active">
          <i class="fas fa-plus-circle"></i> Add Publication
        </a>
        <a href="#" data-tab="data" class="nav-link">
          <i class="fas fa-database"></i> Manage Data
        </a>
      </div>
    </nav>

    <!-- Form Tab Content -->
    <div id="form-tab" class="tab-content active">
      <div class="form-wrapper">
        <div class="form-container">
          <form id="publication-form">
            <!-- Issue Information Section -->
            <div class="form-section">
              <h2 class="section-title"><i class="fas fa-book"></i> Issue Information</h2>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="issue_id">Issue ID <span class="required">*</span></label>
                  <input type="text" id="issue_id" name="issue_id" value="issue8" required>
                </div>
                <div class="form-group">
                  <label for="volume">Volume <span class="required">*</span></label>
                  <input type="number" id="volume" name="volume" value="8" required>
                </div>
              </div>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="number">Number <span class="required">*</span></label>
                  <input type="number" id="number" name="number" value="2" required>
                </div>
                <div class="form-group">
                  <label for="year">Year <span class="required">*</span></label>
                  <input type="number" id="year" name="year" min="1900" max="2100" value="2025" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="issue_title">Issue Title <span class="required">*</span></label>
                  <input type="text" id="issue_title" name="issue_title" value="Vol. 8 No. 2 (2025)" required>
                </div>
              </div>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="issue_published_date">Issue Published Date <span class="required">*</span></label>
                  <input type="date" id="issue_published_date" name="issue_published_date" value="2025-06-15" required>
                </div>
                <div class="form-group">
                  <label for="issue_cover_image">Issue Cover Image <span class="optional">(Optional)</span></label>
                  <div class="file-upload-container" ondrop="handleDrop(event, 'cover')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <input type="file" id="issue_cover_image" name="issue_cover_image" class="file-input" accept="image/*" onchange="handleFileChange(event, 'cover')">
                    <div class="file-upload-content">
                      <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                      </div>
                      <div class="file-upload-text">Drag & drop cover image here</div>
                      <div class="file-upload-hint">or click to browse (JPG, PNG, GIF - Max 10MB)</div>
                    </div>
                  </div>
                  <div class="file-preview" id="cover-preview"></div>
                  <div class="upload-progress" id="cover-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" id="cover-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="cover-progress-text">Uploading...</div>
                  </div>
                  <input type="hidden" id="issue_cover_image_url" name="issue_cover_image_url">
                </div>
              </div>
            </div>

            <!-- Article Information Section -->
            <div class="form-section">
              <h2 class="section-title"><i class="fas fa-document"></i> Article Information</h2>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="article_id">Article ID <span class="required">*</span></label>
                  <input type="text" id="article_id" name="article_id" value="" required placeholder="e.g., ART-2025-001">
                </div>
                <div class="form-group">
                  <label for="doi">DOI <span class="optional">(Optional)</span></label>
                  <input type="text" id="doi" name="doi" value="" placeholder="e.g., 10.1000/183">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="article_title">Article Title <span class="required">*</span></label>
                  <input type="text" id="article_title" name="article_title" value="" required placeholder="Enter the full title of the article">
                </div>
              </div>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="author">Main Author <span class="required">*</span></label>
                  <input type="text" id="author" name="author" value="" required placeholder="eg:name,position,email semicolon for more">
                </div>
                <div class="form-group">
                  <label for="authors">All Authors <span class="optional">(Optional)</span></label>
                  <input type="text" id="authors" name="authors" value="" placeholder="Separate multiple authors with commas">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="abstract">Abstract <span class="required">*</span></label>
                  <textarea id="abstract" name="abstract" required placeholder="Enter the article abstract here..."></textarea>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="keywords">Keywords <span class="required">*</span></label>
                  <input type="text" id="keywords" name="keywords" value="" required placeholder="Separate keywords with commas">
                </div>
              </div>
            </div>

            <!-- Publication Details Section -->
            <div class="form-section">
              <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Publication Details</h2>

              <div class="form-row three-cols">
                <div class="form-group">
                  <label for="date">Submission Date <span class="required">*</span></label>
                  <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                  <label for="published_date">Published Date <span class="required">*</span></label>
                  <input type="text" id="published_date" name="published_date" value="" required placeholder="e.g., June 15, 2025">
                </div>
                <div class="form-group">
                  <label for="pages">Pages <span class="required">*</span></label>
                  <input type="text" id="pages" name="pages" value="" required placeholder="e.g., 25-48">
                </div>
              </div>
            </div>

            <!-- File Links Section -->
            <div class="form-section">
              <h2 class="section-title"><i class="fas fa-link"></i> File Links</h2>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="html_file">HTML File URL <span class="required">*</span></label>
                  <input type="url" id="html_file" name="html_file" value="" required placeholder="https://...">
                </div>
                <div class="form-group">
                  <label for="pdf_url">PDF File <span class="optional">(Optional)</span></label>
                  <div class="file-upload-container" ondrop="handleDrop(event, 'pdf')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <input type="file" id="pdf_url" name="pdf_url" class="file-input" accept=".pdf" onchange="handleFileChange(event, 'pdf')">
                    <div class="file-upload-content">
                      <div class="file-upload-icon">
                        <i class="fas fa-file-pdf"></i>
                      </div>
                      <div class="file-upload-text">Drag & drop PDF file here</div>
                      <div class="file-upload-hint">or click to browse (PDF - Max 50MB)</div>
                    </div>
                  </div>
                  <div class="file-preview" id="pdf-preview"></div>
                  <div class="upload-progress" id="pdf-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" id="pdf-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="pdf-progress-text">Uploading...</div>
                  </div>
                  <input type="hidden" id="pdf_url_link" name="pdf_url_link">
                </div>
              </div>
            </div>

            <div class="submit-section">
              <button type="submit" class="submit-btn" id="submit-btn">
                <i class="fas fa-paper-plane"></i> Submit Publication
              </button>

              <div class="loading-state" id="loading-state">
                <i class="fas fa-spinner fa-spin"></i> Submitting your publication...
              </div>

              <div class="message success-message" id="success-message">
                <strong><i class="fas fa-check-circle"></i> Success!</strong> Your publication has been submitted successfully and saved to the database.
              </div>

              <div class="message error-message" id="error-message">
                <strong><i class="fas fa-exclamation-triangle"></i> Submission Error!</strong>
                <span id="error-text">There was an error submitting your form. Please try again.</span>
              </div>

              <div class="message validation-error" id="validation-error">
                <strong><i class="fas fa-exclamation-triangle"></i> Validation Error!</strong>
                Please fill in all required fields before submitting.
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Data Management Tab Content -->
    <div id="data-tab" class="tab-content">
      <div class="data-wrapper">
        <div class="data-container">
          <div class="data-stats" id="data-stats">
            <div class="stat-card">
              <div class="stat-number" id="total-publications">0</div>
              <div class="stat-label">Total Publications</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="current-year-publications">0</div>
              <div class="stat-label">Current Year</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="total-authors">0</div>
              <div class="stat-label">Unique Authors</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="total-volumes">0</div>
              <div class="stat-label">Volumes</div>
            </div>
          </div>

          <div class="loading-spinner" id="data-loading">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p>Loading publication data...</p>
          </div>

          <div class="data-table-container" id="data-table-container" style="display: none;">
            <table class="data-table" id="data-table">
              <thead>
                <tr>
                  <th>Issue ID</th>
                  <th>Volume</th>
                  <th>Number</th>
                  <th>Year</th>
                  <th>Issue Title</th>
                  <th>Issue Date</th>
                  <th>Cover Image</th>
                  <th>Article ID</th>
                  <th>Article Title</th>
                  <th>Author</th>
                  <th>Abstract</th>
                  <th>Submission Date</th>
                  <th>Published Date</th>
                  <th>Keywords</th>
                  <th>Pages</th>
                  <th>HTML File</th>
                  <th>PDF URL</th>
                  <th>DOI</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="data-table-body">
              </tbody>
            </table>
          </div>

          <div class="no-data" id="no-data" style="display: none;">
            <i class="fas fa-inbox fa-3x" style="color: var(--gray-400); margin-bottom: 1rem;"></i>
            <p>No publications found. Add your first publication using the form.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for viewing/editing publication details -->
    <div class="modal" id="publication-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="modal-title">Publication Details</h2>
          <button class="close-modal" onclick="closeModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="modal-body">
          <!-- Content will be dynamically loaded here -->
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-container">
        <div class="footer-grid">
          <div class="footer-section">
            <div class="logo-container" style="margin-bottom: 1.2rem">
              <img src="https://quaf2026.netlify.app/majalla/logo.png" alt="Quaf Academic Logo" class="logo-image">
              <div class="logo-text-container">
                <h1 class="logo-text" style="color: white">Quaf Academic</h1>
                <p class="logo-subtitle" style="color: #d1d5db">Journal of Islamic Studies</p>
              </div>
            </div>
            <p class="text-gray-300 mb-4">
                     <strong> MAILING ADDRESS:</strong><br>Editor, Quaf Academic Journal of Islamic Studies, Darul Hidaya Da'wa College,<br>Manoor,Kalady (PO), Malappuram (Dt.),<br>679582 (PIN), Kerala, India.<br><br>Email: quaf@dhdc.me <br><br>Website: www.quaf.me
                    </p>
          </div>

          <div class="footer-section">
            <h3>Admin Functions</h3>
            <ul class="footer-links">
              <li><a href="#" data-tab="form">Add Publication</a></li>
              <li><a href="#" data-tab="data">Manage Data</a></li>
            </ul>
          </div>

          <div class="footer-section">
            <h3>Connect</h3>
            <div class="social-links">
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-facebook"></i></a>
              <a href="#"><i class="fab fa-linkedin"></i></a>
              <a href="#"><i class="fas fa-envelope"></i></a>
            </div>
          </div>
        </div>

        <div class="footer-bottom">
          <p>Â© 2025 Quaf Academic Journal. All rights reserved. | Admin Panel v2.1</p>
        </div>
      </div>
    </footer>

    <script>
      // Configuration - UPDATE THESE WITH YOUR ACTUAL URLS
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxZ7_2Ctv2HpKWgkebL4nCs-xX9c2Qi0fphPVvKtg7pN190KZi0Fl39UTq9pGfEl6TA/exec';
      const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSkzubKLpyPWDjAWl5XS83-4huOcBJDZeeLRKVbntV2sDo-uG5Tzw5aFA6PQw3rNNv4-L-_44asHfTr/pub?gid=0&single=true&output=csv';
      
      // Global variables
      let publicationsData = [];
      let uploadedFiles = {
        cover: null,
        pdf: null
      };

      // File upload handling functions
      function handleDragOver(event) {
        event.preventDefault();
        event.stopPropagation();
        event.currentTarget.classList.add('dragover');
      }

      function handleDragLeave(event) {
        event.preventDefault();
        event.stopPropagation();
        event.currentTarget.classList.remove('dragover');
      }

      function handleDrop(event, type) {
        event.preventDefault();
        event.stopPropagation();
        event.currentTarget.classList.remove('dragover');

        const files = event.dataTransfer.files;
        if (files.length > 0) {
          const fileInput = document.getElementById(getFileInputId(type));
          fileInput.files = files;
          handleFileChange({ target: { files: files } }, type);
        }
      }

      function getFileInputId(type) {
        switch(type) {
          case 'cover': return 'issue_cover_image';
          case 'pdf': return 'pdf_url';
          case 'edit-cover': return 'edit_issue_cover_image';
          case 'edit-pdf': return 'edit_pdf_url';
          default: return '';
        }
      }

      function handleFileChange(event, type) {
        const file = event.target.files[0];
        if (!file) return;

        console.log(`File selected for ${type}:`, file.name);

        // Validate file
        if (!validateFile(file, type)) {
          return;
        }

        // Show preview
        showFilePreview(file, type);

        // Upload file
        uploadFile(file, type);
      }

      function validateFile(file, type) {
        const maxSizes = {
          cover: 10 * 1024 * 1024, // 10MB for images
          pdf: 50 * 1024 * 1024,   // 50MB for PDFs
          'edit-cover': 10 * 1024 * 1024,
          'edit-pdf': 50 * 1024 * 1024
        };

        const allowedTypes = {
          cover: ['image/jpeg', 'image/png', 'image/gif'],
          pdf: ['application/pdf'],
          'edit-cover': ['image/jpeg', 'image/png', 'image/gif'],
          'edit-pdf': ['application/pdf']
        };

        const cleanType = type.replace('edit-', '');
        const maxSize = maxSizes[type] || maxSizes[cleanType];
        const allowedType = allowedTypes[type] || allowedTypes[cleanType];

        if (file.size > maxSize) {
          alert(`File size too large. Maximum size is ${maxSize / (1024 * 1024)}MB.`);
          return false;
        }

        if (!allowedType.includes(file.type)) {
          alert(`Invalid file type. Please select a ${cleanType === 'cover' ? 'valid image' : 'PDF'} file.`);
          return false;
        }

        return true;
      }

      function showFilePreview(file, type) {
        console.log(`Showing preview for ${type}:`, file.name);
        
        const previewId = `${type}-preview`;
        const preview = document.getElementById(previewId);
        if (!preview) {
          console.error(`Preview element not found for type: ${type}, looking for ID: ${previewId}`);
          return;
        }
        
        preview.classList.add('active');
        
        const fileSize = (file.size / 1024 / 1024).toFixed(2);
        const iconClass = type.includes('cover') ? 'fas fa-image' : 'fas fa-file-pdf';
        
        preview.innerHTML = `
          <div class="file-info">
            <div class="file-details">
              <div class="file-icon">
                <i class="${iconClass}"></i>
              </div>
              <div>
                <div class="file-name">${file.name}</div>
                <div class="file-size">${fileSize} MB</div>
              </div>
            </div>
            <div class="file-actions">
              <button type="button" class="file-remove-btn" onclick="removeFile('${type}')">
                <i class="fas fa-trash"></i> Remove
              </button>
            </div>
          </div>
        `;
      }

      function removeFile(type) {
        const fileInputId = getFileInputId(type);
        const hiddenInputId = getHiddenInputId(type);
        const previewId = `${type}-preview`;
        const progressId = `${type}-progress`;

        const fileInput = document.getElementById(fileInputId);
        const hiddenInput = document.getElementById(hiddenInputId);
        const preview = document.getElementById(previewId);
        const progress = document.getElementById(progressId);

        if (fileInput) fileInput.value = '';
        if (hiddenInput) hiddenInput.value = '';
        if (preview) {
          preview.classList.remove('active');
          preview.innerHTML = '';
        }
        if (progress) progress.classList.remove('active');
        
        // Clear from global uploadedFiles object
        uploadedFiles[type] = null;
      }

      function getHiddenInputId(type) {
        switch(type) {
          case 'cover': return 'issue_cover_image_url';
          case 'pdf': return 'pdf_url_link';
          case 'edit-cover': return 'edit_issue_cover_image_url';
          case 'edit-pdf': return 'edit_pdf_url_link';
          default: return '';
        }
      }

      async function uploadFile(file, type) {
        console.log(`Starting upload for ${type}`, file.name);
        
        const progressId = `${type}-progress`;
        const progressFillId = `${type}-progress-fill`;
        const progressTextId = `${type}-progress-text`;
        
        const progress = document.getElementById(progressId);
        const progressFill = document.getElementById(progressFillId);
        const progressText = document.getElementById(progressTextId);
        
        if (!progress || !progressFill || !progressText) {
          console.error(`Progress elements not found for type: ${type}`);
          return;
        }
        
        progress.classList.add('active');
        progressText.textContent = 'Uploading...';
        progressFill.style.width = '0%';

        try {
          console.log(`Starting upload for ${type} file:`, file.name, file.type, file.size);

          // Convert file to base64 for Google Apps Script
          const base64Data = await fileToBase64(file);
          
          // Create form data with base64 content
          const formData = new FormData();
          formData.append('action', 'upload');
          formData.append('type', type.replace('edit-', '')); // Remove edit- prefix for server
          formData.append('fileName', file.name);
          formData.append('fileType', file.type);
          formData.append('fileSize', file.size);
          formData.append('fileData', base64Data);

          // Simulate progress
          let progressValue = 0;
          const progressInterval = setInterval(() => {
            progressValue += Math.random() * 15;
            if (progressValue > 90) {
              clearInterval(progressInterval);
              progressValue = 90;
            }
            progressFill.style.width = progressValue + '%';
          }, 200);

          // Upload to Google Script
          const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            body: formData
          });

          clearInterval(progressInterval);

          if (response.ok) {
            const result = await response.json();
            console.log(`Upload result for ${type}:`, result);
            
            if (result.status === 'success') {
              const driveUrl = result.fileUrl;
              
              const hiddenInputId = getHiddenInputId(type);
              const hiddenInput = document.getElementById(hiddenInputId);
              if (hiddenInput) {
                hiddenInput.value = driveUrl;
                console.log(`Set ${hiddenInputId} to:`, driveUrl);
              }
              
              // Update global uploadedFiles object
              uploadedFiles[type] = {
                file: file,
                url: driveUrl,
                fileId: result.fileId
              };

              progressFill.style.width = '100%';
              progressText.textContent = 'Upload complete!';
              
              console.log(`${type} file uploaded successfully:`, driveUrl);
              
              setTimeout(() => {
                progress.classList.remove('active');
              }, 2000);

            } else {
              throw new Error(result.message || 'Upload failed');
            }
          } else {
            const errorText = await response.text();
            throw new Error(`HTTP ${response.status}: ${response.statusText}. ${errorText}`);
          }

        } catch (error) {
          console.error(`Upload error for ${type}:`, error);
          progressText.textContent = 'Upload failed: ' + error.message;
          progressFill.style.width = '0%';
          
          setTimeout(() => {
            progress.classList.remove('active');
          }, 3000);
        }
      }

      // Helper function to convert file to base64
      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => resolve(reader.result);
          reader.onerror = error => reject(error);
        });
      }

      // Tab switching functionality
      function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
          tab.classList.remove('active');
        });

        document.querySelectorAll('.nav-link').forEach(link => {
          link.classList.remove('active');
        });

        const targetTab = document.getElementById(tabName + '-tab');
        if (targetTab) {
          targetTab.classList.add('active');
        }

        document.querySelectorAll(`[data-tab="${tabName}"]`).forEach(link => {
          link.classList.add('active');
        });

        if (tabName === 'data') {
          loadPublicationsData();
        }

        document.getElementById('mobile-nav').classList.remove('active');
      }

      // Mobile menu toggle
      function toggleMobileMenu() {
        const mobileNav = document.getElementById('mobile-nav');
        mobileNav.classList.toggle('active');
      }

      // Event listeners for navigation
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('[data-tab]').forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const tabName = this.getAttribute('data-tab');
            switchTab(tabName);
          });
        });

        initializeForm();
        loadPublicationsData();
      });

      function initializeForm() {
        const form = document.getElementById('publication-form');
        const dateField = document.getElementById('date');
        
        if (!dateField.value) {
          const today = new Date().toISOString().split('T')[0];
          dateField.value = today;
        }

        form.addEventListener('submit', handleFormSubmission);

        document.querySelectorAll('input, textarea, select').forEach((field) => {
          field.addEventListener('blur', function () {
            if (this.hasAttribute('required') && !this.value.trim()) {
              this.classList.add('error');
            } else {
              this.classList.remove('error');
            }
          });

          field.addEventListener('input', function () {
            if (this.classList.contains('error') && this.value.trim()) {
              this.classList.remove('error');
            }
          });
        });

        console.log('Form initialized and ready for submission');
      }

      async function handleFormSubmission(e) {
        e.preventDefault();

        const submitBtn = document.getElementById('submit-btn');
        const loadingState = document.getElementById('loading-state');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const validationError = document.getElementById('validation-error');

        // Hide all messages
        successMessage.style.display = 'none';
        errorMessage.style.display = 'none';
        validationError.style.display = 'none';

        console.log('Form submission started...');

        if (!validateForm()) {
          console.log('Validation failed');
          validationError.style.display = 'block';
          validationError.scrollIntoView({ behavior: 'smooth' });
          return;
        }

        submitBtn.disabled = true;
        loadingState.style.display = 'block';

        try {
          // Create data object directly from form elements
          const data = {
            action: 'submit'
          };

          // Collect all form data manually to avoid FormData issues
          const formElements = e.target.elements;
          for (let element of formElements) {
            if (element.name && element.type !== 'file') {
              data[element.name] = String(element.value || '').trim();
            }
          }

          // Handle file URLs - use uploaded URLs or existing values
          const coverImageUrl = document.getElementById('issue_cover_image_url').value;
          const pdfUrl = document.getElementById('pdf_url_link').value;

          // Use uploaded file URLs if available
          if (coverImageUrl) {
            data.issue_cover_image = coverImageUrl;
            data.issue_cover_image_url = coverImageUrl;
          } else {
            data.issue_cover_image = '';
            data.issue_cover_image_url = '';
          }

          if (pdfUrl) {
            data.pdf_url = pdfUrl;
            data.pdf_url_link = pdfUrl;
          } else {
            data.pdf_url = '';
            data.pdf_url_link = '';
          }

          console.log('Submitting data:', data);

          const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(data).toString()
          });

          console.log('Response status:', response.status);
          
          if (response.ok) {
            const result = await response.json();
            console.log('Response result:', result);
            
            if (result.status === 'success') {
              loadingState.style.display = 'none';
              successMessage.style.display = 'block';
              successMessage.scrollIntoView({ behavior: 'smooth' });
              
              setTimeout(() => {
                clearForm();
                if (document.getElementById('data-tab').classList.contains('active')) {
                  loadPublicationsData();
                }
              }, 2000);
            } else {
              throw new Error(result.message || 'Submission failed');
            }
          } else {
            const errorText = await response.text();
            throw new Error(`HTTP ${response.status}: ${response.statusText}. ${errorText}`);
          }

        } catch (error) {
          console.error('Submission error:', error);
          loadingState.style.display = 'none';
          
          document.getElementById('error-text').textContent = 
            `Submission failed: ${error.message}. Please check your internet connection and try again.`;
          errorMessage.style.display = 'block';
          errorMessage.scrollIntoView({ behavior: 'smooth' });
        } finally {
          submitBtn.disabled = false;
        }
      }

      function validateForm() {
        const requiredFields = document.querySelectorAll('input[required], textarea[required], select[required]');
        let isValid = true;
        const missingFields = [];

        // Clear previous error states
        document.querySelectorAll('.error').forEach(field => {
          field.classList.remove('error');
        });

        requiredFields.forEach((field) => {
          let fieldValue = '';
          
          // Special handling for file inputs
          if (field.type === 'file') {
            const fieldName = field.name;
            if (fieldName === 'issue_cover_image') {
              // Check if cover image is uploaded (either file selected or URL exists)
              const hiddenUrl = document.getElementById('issue_cover_image_url').value;
              const hasFile = field.files.length > 0;
              if (!hasFile && !hiddenUrl) {
                field.classList.add('error');
                missingFields.push('Cover Image');
                isValid = false;
              }
            }
            // PDF is optional, so skip validation for pdf_url
          } else {
            // Convert to string first, then trim to avoid the error
            fieldValue = String(field.value || '').trim();
            if (!fieldValue) {
              field.classList.add('error');
              missingFields.push(field.name || field.id);
              isValid = false;
            }
          }
        });

        // Validate URL fields
        const urlFields = document.querySelectorAll('input[type="url"]');
        urlFields.forEach((field) => {
          const fieldValue = String(field.value || '').trim();
          if (field.hasAttribute('required') && fieldValue) {
            try {
              new URL(fieldValue);
            } catch {
              field.classList.add('error');
              missingFields.push(field.name || field.id);
              isValid = false;
            }
          }
        });

        // Debug log to see what's missing
        if (!isValid) {
          console.log('Validation failed. Missing fields:', missingFields);
        }

        return isValid;
      }

      function clearForm() {
        const form = document.getElementById('publication-form');
        form.reset();
        
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = today;
        
        // Reset default values
        document.getElementById('issue_id').value = 'issue8';
        document.getElementById('volume').value = '8';
        document.getElementById('number').value = '2';
        document.getElementById('year').value = '2025';
        document.getElementById('issue_title').value = 'Vol. 8 No. 2 (2025)';
        document.getElementById('issue_published_date').value = '2025-06-15';
        
        document.querySelectorAll('.error').forEach(field => {
          field.classList.remove('error');
        });

        document.querySelectorAll('.message').forEach(msg => {
          msg.style.display = 'none';
        });

        // Clear uploaded files
        removeFile('cover');
        removeFile('pdf');

        console.log('Form cleared');
      }

      // Data management functions
      async function loadPublicationsData() {
        const loading = document.getElementById('data-loading');
        const tableContainer = document.getElementById('data-table-container');
        const noData = document.getElementById('no-data');

        try {
          loading.classList.add('active');
          tableContainer.style.display = 'none';
          noData.style.display = 'none';

          console.log('Fetching data from:', CSV_URL);
          
          const response = await fetch(CSV_URL);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const csvText = await response.text();
          console.log('CSV data received, length:', csvText.length);
          
          publicationsData = parseCSV(csvText);
          
          console.log('Parsed publications:', publicationsData.length);

          if (publicationsData.length === 0) {
            noData.style.display = 'block';
          } else {
            updateDataStats();
            renderDataTable();
            tableContainer.style.display = 'block';
          }

        } catch (error) {
          console.error('Error loading data:', error);
          noData.style.display = 'block';
          document.querySelector('#no-data p').textContent = 
            `Error loading data: ${error.message}. Please check your connection and try again.`;
        } finally {
          loading.classList.remove('active');
        }
      }

      // CSV parsing function
      function parseCSV(csvText) {
        const lines = csvText.trim().split('\n');
        if (lines.length < 2) return [];

        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
        const data = [];

        for (let i = 1; i < lines.length; i++) {
          const values = parseCSVLine(lines[i]);
          if (values.length === headers.length) {
            const row = {};
            headers.forEach((header, index) => {
              row[header] = values[index] || '';
            });
            data.push(row);
          }
        }

        return data;
      }

      // Helper function to parse CSV line with proper comma handling
      function parseCSVLine(line) {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            result.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        
        result.push(current.trim());
        return result;
      }

      // Update data statistics
      function updateDataStats() {
        const currentYear = new Date().getFullYear();
        const currentYearPubs = publicationsData.filter(pub => pub.year == currentYear).length;
        const uniqueAuthors = [...new Set(publicationsData.map(pub => pub.author))].length;
        const uniqueVolumes = [...new Set(publicationsData.map(pub => pub.volume))].length;

        document.getElementById('total-publications').textContent = publicationsData.length;
        document.getElementById('current-year-publications').textContent = currentYearPubs;
        document.getElementById('total-authors').textContent = uniqueAuthors;
        document.getElementById('total-volumes').textContent = uniqueVolumes;
      }

      // Render data table - Show all data without pagination
      function renderDataTable() {
        const tbody = document.getElementById('data-table-body');
        tbody.innerHTML = '';

        publicationsData.forEach((pub, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="truncate-short" title="${pub.issue_id || 'N/A'}">${pub.issue_id || 'N/A'}</td>
            <td>${pub.volume || 'N/A'}</td>
            <td>${pub.number || 'N/A'}</td>
            <td>${pub.year || 'N/A'}</td>
            <td class="truncate-text" title="${pub.issue_title || 'N/A'}">${pub.issue_title || 'N/A'}</td>
            <td class="truncate-short">${pub.issue_published_date || 'N/A'}</td>
            <td class="truncate-short">${pub.issue_cover_image ? `<a href="${pub.issue_cover_image}" target="_blank">View</a>` : 'N/A'}</td>
            <td class="truncate-short" title="${pub.article_id || 'N/A'}">${pub.article_id || 'N/A'}</td>
            <td class="truncate-text" title="${pub.article_title || 'N/A'}">${pub.article_title || 'N/A'}</td>
            <td class="truncate-text" title="${pub.author || 'N/A'}">${pub.author || 'N/A'}</td>
            <td class="truncate-text" title="${pub.abstract || 'N/A'}">${pub.abstract ? pub.abstract.substring(0, 50) + '...' : 'N/A'}</td>
            <td class="truncate-short">${pub.date || 'N/A'}</td>
            <td class="truncate-text">${pub.published_date || 'N/A'}</td>
            <td class="truncate-text" title="${pub.keywords || 'N/A'}">${pub.keywords || 'N/A'}</td>
            <td class="truncate-short">${pub.pages || 'N/A'}</td>
            <td class="truncate-short">${pub.html_file ? `<a href="${pub.html_file}" target="_blank">View</a>` : 'N/A'}</td>
            <td class="truncate-short">${pub.pdf_url ? `<a href="${pub.pdf_url}" target="_blank">View</a>` : 'N/A'}</td>
            <td class="truncate-short">${pub.doi || 'N/A'}</td>
            <td class="actions">
              <button class="action-icon view" onclick="viewPublication(${index})" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
              <button class="action-icon edit" onclick="editPublication(${index})" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              ${pub.html_file ? `<button class="action-icon view" onclick="window.open('${pub.html_file}', '_blank')" title="View Article">
                <i class="fas fa-external-link-alt"></i>
              </button>` : ''}
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      // View publication details
      function viewPublication(index) {
        const pub = publicationsData[index];
        const modal = document.getElementById('publication-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');

        modalTitle.textContent = 'Publication Details';
        modalBody.innerHTML = `
          <div style="display: grid; gap: 1.2rem;">
            <div class="form-section">
              <h3 class="section-title">Issue Information</h3>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.85rem;">
                <div><strong>Issue ID:</strong> ${pub.issue_id || 'N/A'}</div>
                <div><strong>Volume:</strong> ${pub.volume || 'N/A'}</div>
                <div><strong>Number:</strong> ${pub.number || 'N/A'}</div>
                <div><strong>Year:</strong> ${pub.year || 'N/A'}</div>
                <div><strong>Issue Title:</strong> ${pub.issue_title || 'N/A'}</div>
                <div><strong>Published Date:</strong> ${pub.issue_published_date || 'N/A'}</div>
              </div>
            </div>
            
            <div class="form-section">
              <h3 class="section-title">Article Information</h3>
              <div style="display: grid; gap: 0.85rem;">
                <div><strong>Article ID:</strong> ${pub.article_id || 'N/A'}</div>
                <div><strong>Title:</strong> ${pub.article_title || 'N/A'}</div>
                <div><strong>Author:</strong> ${pub.author || 'N/A'}</div>
                <div><strong>DOI:</strong> ${pub.doi || 'N/A'}</div>
                <div><strong>Keywords:</strong> ${pub.keywords || 'N/A'}</div>
                <div><strong>Pages:</strong> ${pub.pages || 'N/A'}</div>
                <div><strong>Submission Date:</strong> ${pub.date || 'N/A'}</div>
                <div><strong>Published Date:</strong> ${pub.published_date || 'N/A'}</div>
              </div>
            </div>
            
            <div class="form-section">
              <h3 class="section-title">Abstract</h3>
              <p style="line-height: 1.5; text-align: justify;">${pub.abstract || 'N/A'}</p>
            </div>
            
            <div class="form-section">
              <h3 class="section-title">File Links</h3>
              <div style="display: grid; gap: 0.85rem;">
                ${pub.html_file ? `<div><strong>HTML:</strong> <a href="${pub.html_file}" target="_blank">${pub.html_file}</a></div>` : ''}
                ${pub.pdf_url ? `<div><strong>PDF:</strong> <a href="${pub.pdf_url}" target="_blank">${pub.pdf_url}</a></div>` : ''}
                ${pub.issue_cover_image ? `<div><strong>Cover Image:</strong> <a href="${pub.issue_cover_image}" target="_blank">${pub.issue_cover_image}</a></div>` : ''}
              </div>
            </div>
          </div>
        `;

        modal.classList.add('active');
      }

      function editPublication(index) {
        const pub = publicationsData[index];
        const modal = document.getElementById('publication-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');

        modalTitle.textContent = 'Edit Publication';
        modalBody.innerHTML = `
          <form id="edit-publication-form" data-index="${index}">
            <!-- Issue Information Section -->
            <div class="form-section">
              <h2 class="section-title"><i class="fas fa-book"></i> Issue Information</h2>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="edit_issue_id">Issue ID <span class="required">*</span></label>
                  <input type="text" id="edit_issue_id" name="issue_id" value="${pub.issue_id || ''}" required>
                </div>
                <div class="form-group">
                  <label for="edit_volume">Volume <span class="required">*</span></label>
                  <input type="number" id="edit_volume" name="volume" value="${pub.volume || ''}" required>
                </div>
              </div>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="edit_number">Number <span class="required">*</span></label>
                  <input type="number" id="edit_number" name="number" value="${pub.number || ''}" required>
                </div>
                <div class="form-group">
                  <label for="edit_year">Year <span class="required">*</span></label>
                  <input type="number" id="edit_year" name="year" min="1900" max="2100" value="${pub.year || ''}" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="edit_issue_title">Issue Title <span class="required">*</span></label>
                  <input type="text" id="edit_issue_title" name="issue_title" value="${pub.issue_title || ''}" required>
                </div>
              </div>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="edit_issue_published_date">Issue Published Date <span class="required">*</span></label>
                  <input type="date" id="edit_issue_published_date" name="issue_published_date" value="${pub.issue_published_date || ''}" required>
                </div>
                <div class="form-group">
                  <label for="edit_issue_cover_image">Issue Cover Image</label>
                  <div class="file-upload-container" ondrop="handleDrop(event, 'edit-cover')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <input type="file" id="edit_issue_cover_image" name="issue_cover_image" class="file-input" accept="image/*" onchange="handleFileChange(event, 'edit-cover')">
                    <div class="file-upload-content">
                      <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                      </div>
                      <div class="file-upload-text">Drag & drop new cover image here</div>
                      <div class="file-upload-hint">or click to browse (JPG, PNG, GIF - Max 10MB)</div>
                    </div>
                  </div>
                  <div class="file-preview ${pub.issue_cover_image ? 'active' : ''}" id="edit-cover-preview">
                    ${pub.issue_cover_image ? `
                      <div class="file-info">
                        <div class="file-details">
                          <div class="file-icon"><i class="fas fa-image"></i></div>
                          <div>
                            <div class="file-name">Current Cover Image</div>
                            <div class="file-size"><a href="${pub.issue_cover_image}" target="_blank">View Current</a></div>
                          </div>
                        </div>
                        <div class="file-actions">
                          <button type="button" class="file-remove-btn" onclick="removeFile('edit-cover')">
                            <i class="fas fa-trash"></i> Remove
                          </button>
                        </div>
                      </div>
                    ` : ''}
                  </div>
                  <div class="upload-progress" id="edit-cover-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" id="edit-cover-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="edit-cover-progress-text">Uploading...</div>
                  </div>
                  <input type="hidden" id="edit_issue_cover_image_url" name="issue_cover_image_url" value="${pub.issue_cover_image || ''}">
                </div>
              </div>
            </div>

            <!-- Article Information Section -->
            <div class="form-section">
              <h2 class="section-title"><i class="fas fa-document"></i> Article Information</h2>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="edit_article_id">Article ID <span class="required">*</span></label>
                  <input type="text" id="edit_article_id" name="article_id" value="${pub.article_id || ''}" required>
                </div>
                <div class="form-group">
                  <label for="edit_doi">DOI <span class="optional">(Optional)</span></label>
                  <input type="text" id="edit_doi" name="doi" value="${pub.doi || ''}">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="edit_article_title">Article Title <span class="required">*</span></label>
                  <input type="text" id="edit_article_title" name="article_title" value="${pub.article_title || ''}" required>
                </div>
              </div>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="edit_author">Main Author <span class="required">*</span></label>
                  <input type="text" id="edit_author" name="author" value="${pub.author || ''}" required>
                </div>
                <div class="form-group">
                  <label for="edit_authors">All Authors <span class="optional">(Optional)</span></label>
                  <input type="text" id="edit_authors" name="authors" value="${pub.authors || ''}">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="edit_abstract">Abstract <span class="required">*</span></label>
                  <textarea id="edit_abstract" name="abstract" required>${pub.abstract || ''}</textarea>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="edit_keywords">Keywords <span class="required">*</span></label>
                  <input type="text" id="edit_keywords" name="keywords" value="${pub.keywords || ''}" required>
                </div>
              </div>
            </div>

            <!-- Publication Details Section -->
            <div class="form-section">
              <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Publication Details</h2>

              <div class="form-row three-cols">
                <div class="form-group">
                  <label for="edit_date">Submission Date <span class="required">*</span></label>
                  <input type="date" id="edit_date" name="date" value="${pub.date || ''}" required>
                </div>
                <div class="form-group">
                  <label for="edit_published_date">Published Date <span class="required">*</span></label>
                  <input type="text" id="edit_published_date" name="published_date" value="${pub.published_date || ''}" required>
                </div>
                <div class="form-group">
                  <label for="edit_pages">Pages <span class="required">*</span></label>
                  <input type="text" id="edit_pages" name="pages" value="${pub.pages || ''}" required>
                </div>
              </div>
            </div>

            <!-- File Links Section -->
            <div class="form-section">
              <h2 class="section-title"><i class="fas fa-link"></i> File Links</h2>

              <div class="form-row two-cols">
                <div class="form-group">
                  <label for="edit_html_file">HTML File URL <span class="required">*</span></label>
                  <input type="url" id="edit_html_file" name="html_file" value="${pub.html_file || ''}" required>
                </div>
                <div class="form-group">
                  <label for="edit_pdf_url">PDF File <span class="optional">(Optional)</span></label>
                  <div class="file-upload-container" ondrop="handleDrop(event, 'edit-pdf')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <input type="file" id="edit_pdf_url" name="pdf_url" class="file-input" accept=".pdf" onchange="handleFileChange(event, 'edit-pdf')">
                    <div class="file-upload-content">
                      <div class="file-upload-icon">
                        <i class="fas fa-file-pdf"></i>
                      </div>
                      <div class="file-upload-text">Drag & drop new PDF file here</div>
                      <div class="file-upload-hint">or click to browse (PDF - Max 50MB)</div>
                    </div>
                  </div>
                  <div class="file-preview ${pub.pdf_url ? 'active' : ''}" id="edit-pdf-preview">
                    ${pub.pdf_url ? `
                      <div class="file-info">
                        <div class="file-details">
                          <div class="file-icon"><i class="fas fa-file-pdf"></i></div>
                          <div>
                            <div class="file-name">Current PDF File</div>
                            <div class="file-size"><a href="${pub.pdf_url}" target="_blank">View Current</a></div>
                          </div>
                        </div>
                        <div class="file-actions">
                          <button type="button" class="file-remove-btn" onclick="removeFile('edit-pdf')">
                            <i class="fas fa-trash"></i> Remove
                          </button>
                        </div>
                      </div>
                    ` : ''}
                  </div>
                  <div class="upload-progress" id="edit-pdf-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" id="edit-pdf-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="edit-pdf-progress-text">Uploading...</div>
                  </div>
                  <input type="hidden" id="edit_pdf_url_link" name="pdf_url_link" value="${pub.pdf_url || ''}">
                </div>
              </div>
            </div>

            <div class="submit-section">
              <button type="submit" class="submit-btn" id="edit-submit-btn">
                <i class="fas fa-save"></i> Update Publication
              </button>

              <div class="loading-state" id="edit-loading-state">
                <i class="fas fa-spinner fa-spin"></i> Updating publication...
              </div>

              <div class="message success-message" id="edit-success-message">
                <strong><i class="fas fa-check-circle"></i> Success!</strong> Publication updated successfully.
              </div>

              <div class="message error-message" id="edit-error-message">
                <strong><i class="fas fa-exclamation-triangle"></i> Update Error!</strong>
                <span id="edit-error-text">There was an error updating the publication.</span>
              </div>
            </div>
          </form>
        `;

        // Initialize edit form
        initializeEditForm();
        modal.classList.add('active');
      }

      // Initialize edit form
      function initializeEditForm() {
        const editForm = document.getElementById('edit-publication-form');
        if (!editForm) return;

        // Add event listener for form submission
        editForm.addEventListener('submit', handleEditFormSubmission);

        // Add validation listeners
        editForm.querySelectorAll('input, textarea, select').forEach((field) => {
          field.addEventListener('blur', function () {
            if (this.hasAttribute('required') && !this.value.trim()) {
              this.classList.add('error');
            } else {
              this.classList.remove('error');
            }
          });

          field.addEventListener('input', function () {
            if (this.classList.contains('error') && this.value.trim()) {
              this.classList.remove('error');
            }
          });
        });

        console.log('Edit form initialized');
      }

      async function handleEditFormSubmission(e) {
        e.preventDefault();

        const form = e.target;
        const index = parseInt(form.getAttribute('data-index'));
        const originalData = publicationsData[index];
        
        const submitBtn = document.getElementById('edit-submit-btn');
        const loadingState = document.getElementById('edit-loading-state');
        const successMessage = document.getElementById('edit-success-message');
        const errorMessage = document.getElementById('edit-error-message');

        // Hide all messages
        successMessage.style.display = 'none';
        errorMessage.style.display = 'none';

        console.log('Edit form submission started for index:', index);
        console.log('Original data:', originalData);

        // Validate form
        if (!validateEditForm(form)) {
          console.log('Edit form validation failed');
          return;
        }

        submitBtn.disabled = true;
        loadingState.style.display = 'block';

        try {
          // Create data object directly from form elements
          const data = {
            action: 'update',
            original_article_id: originalData.article_id
          };

          // Collect all form data manually to avoid FormData issues
          const formElements = form.elements;
          for (let element of formElements) {
            if (element.name && element.type !== 'file') {
              data[element.name] = String(element.value || '').trim();
            }
          }

          // Handle file URLs - use uploaded URLs or existing values
          const editCoverImageUrl = document.getElementById('edit_issue_cover_image_url').value;
          const editPdfUrl = document.getElementById('edit_pdf_url_link').value;

          // Use updated URLs if available, otherwise keep original
          data.issue_cover_image = editCoverImageUrl || '';
          data.issue_cover_image_url = editCoverImageUrl || '';
          data.pdf_url = editPdfUrl || '';
          data.pdf_url_link = editPdfUrl || '';

          console.log('Submitting update data:', data);

          const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(data).toString()
          });

          console.log('Update response status:', response.status);

          if (response.ok) {
            const result = await response.json();
            console.log('Update response result:', result);
            
            if (result.status === 'success') {
              loadingState.style.display = 'none';
              successMessage.style.display = 'block';
              successMessage.scrollIntoView({ behavior: 'smooth' });
              
              setTimeout(() => {
                closeModal();
                loadPublicationsData(); // Refresh the data table
              }, 2000);
            } else {
              throw new Error(result.message || 'Update failed');
            }
          } else {
            const errorText = await response.text();
            throw new Error(`HTTP ${response.status}: ${response.statusText}. ${errorText}`);
          }

        } catch (error) {
          console.error('Update error:', error);
          loadingState.style.display = 'none';

          document.getElementById('edit-error-text').textContent = 
            `Update failed: ${error.message}. Please check your internet connection and try again.`;
          errorMessage.style.display = 'block';
          errorMessage.scrollIntoView({ behavior: 'smooth' });
        } finally {
          submitBtn.disabled = false;
        }
      }

      // Validate edit form
      function validateEditForm(form) {
        const requiredFields = form.querySelectorAll('input[required], textarea[required], select[required]');
        let isValid = true;

        // Clear previous error states
        form.querySelectorAll('.error').forEach(field => {
          field.classList.remove('error');
        });

        requiredFields.forEach((field) => {
          const fieldValue = String(field.value || '').trim();
          if (!fieldValue) {
            field.classList.add('error');
            isValid = false;
          }
        });

        // Validate URL fields
        const urlFields = form.querySelectorAll('input[type="url"]');
        urlFields.forEach((field) => {
          const fieldValue = String(field.value || '').trim();
          if (field.hasAttribute('required') && fieldValue) {
            try {
              new URL(fieldValue);
            } catch {
              field.classList.add('error');
              isValid = false;
            }
          }
        });

        return isValid;
      }

      // Close modal
      function closeModal() {
        document.getElementById('publication-modal').classList.remove('active');
      }

      // Close modal when clicking outside
      document.getElementById('publication-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeModal();
        }
      });

      console.log('Admin panel initialized successfully');
    </script>
  </body>
</html>
